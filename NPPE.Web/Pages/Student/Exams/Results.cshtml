@page
@model NPPE.Web.Pages.Student.Exams.ResultsModel
@{
    ViewData["Title"] = "Exam Results";
}

<div class="max-w-4xl mx-auto">
    <div class="text-center mb-8">
        <h1 class="text-2xl font-bold text-gray-900">Exam Results</h1>
        <p class="mt-2 text-lg">
            <span class="font-semibold">@Model.Attempt.Score</span> out of <span class="font-semibold">@Model.Attempt.TotalQuestions</span>
        </p>
        <div class="mt-2 inline-block px-4 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-medium">
            @(Math.Round((double)Model.Attempt.Score / Model.Attempt.TotalQuestions * 100))% Correct
        </div>
    </div>

    <div class="space-y-6">
        @for (int i = 0; i < Model.Attempt.Questions.Count; i++)
        {
            var q = Model.Attempt.Questions[i];
            <div class="border border-gray-200 rounded-lg p-5">
                <div class="flex items-start">
                    <span class="inline-flex items-center justify-center h-6 w-6 rounded-full bg-gray-800 text-white font-bold mr-3 flex-shrink-0">
                        @(i + 1)
                    </span>
                    <div>
                        <p class="text-gray-900">@q.QuestionText</p>

                        <div class="mt-3 pl-2 border-l-4 @(q.IsCorrect ? "border-green-500" : "border-red-500")">
                            <p class="text-sm">
                                <span class="font-medium">Your answer:</span>
                                <span class="@(q.IsCorrect ? "text-green-700" : "text-red-700")">
                                    @q.SelectedLabel. @q.SelectedText
                                </span>
                            </p>
                            @if (!q.IsCorrect)
                            {
                                <p class="text-sm mt-1">
                                    <span class="font-medium">Correct answer:</span>
                                    <span class="text-green-700">@q.CorrectLabel. @q.CorrectText</span>
                                </p>
                            }
                        </div>

                        <div class="mt-3 text-sm @(q.IsCorrect ? "text-green-700" : "text-red-700")">
                            @q.FeedbackMessage.Replace("\n", "<br />")
                        </div>
                    </div>
                </div>
            </div>
        }
    </div>

    <div class="mt-8 flex justify-center space-x-4">
        <a asp-page="/Student/Exams/Index"
           class="px-4 py-2 bg-gray-200 text-gray-800 text-sm font-medium rounded-md hover:bg-gray-300">
            Back to Exams
        </a>
        <a asp-page="Take" asp-route-id="@Model.ExamId"
           class="px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-md hover:bg-blue-700">
            Retake Exam
        </a>
    </div>
</div>